## 什么是 ABI？

ABI 英文全称是 Application Binary Interface，即应用二进制接口，是位于两个二进制程序模块之间的接口。一般来说，一个模块是一个库或者操作系统，另个模块是用户在使用的程序。



ABI 主要用于定义在机器码层面，如何访问数据结构或者执行计算机流程。约定的细节包括：



1. 数据类型的大小、布局和对齐

2. 调用约定（控制着函数的参数如何传送以及如何接受返回值）例如，是所有的参数都通过栈传递，还是部分参数通过寄存器传递；哪个寄存器用于哪个函数参数；通过栈传递的第一个函数参数是最先push到栈上还是最后；

3. 系统调用的编码和一个应用如何向操作系统进行系统调用



苹果之前宣布在 Swift 5 的时候，宣布了 Swift ABI 稳定。



我们先来说说，在 Swift 5 之前 ABI 不稳定的情况。不稳定意味着在运行时，程序的二进制代码不能直接与系统的二进制代码产生交互。为了解决这个问题，当开发者使用 Swift 开发应用打包后，需要在包内嵌入 Swift Runtime 库。否则系统就不能正常运行你的应用。将 Runtime 库引入包内，直接导致包体积增大。



在 Swift 5 ABI 稳定之后，使用 Swift 5 开发并打包后就不需要将 Runtime 库打入包内，直接使用系统自带的 Runtime 库即可运行（注意 iOS 版本要不低于 Swift 5 发布的版本）。因此可以说，对开发者而言，包体积会变小。一般能减少 10M 左右。



那么 Swift ABI 稳定会有什么问题呢？

请注意下面 iOS 和 Swift 的版本对应关系，仅仅是举例说的，并不是真正的对应关系。

比如在你使用 iOS 14 对应的 Swift 6 进行开发时，并且应用到了Swift 6 新特性，你的应用要在 iOS 13 中兼容，因为 iOS 系统内置的只有 Swift5.2 的版本，是没有这些特性的，那就意味着你需要写兼容代码，比如下面的代码：

```swift

// 假如 Swift 6.0 是 iOS 14.0 的 Swift 版本

if #available(iOS 14.0, *) {

// Swift 6.0 标准库中存在 A

let a = A()

} else {

// 不存在 A 时的处理

}

```

